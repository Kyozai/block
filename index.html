<!DOCTYPE html>
<html>
<head>
    <title>Block Kyozai</title>
    <!-- BlocklyライブラリのCDNを読み込む -->
    <script src="https://unpkg.com/blockly"></script>
</head>
<body>
    <!-- ブロックの作業領域を表示するための要素 -->
    <div id="blocklyDiv" style="height: 400px; width: 600px;"></div>

    <!-- ツールボックスを定義 -->
    <xml id="toolbox" style="display: none;">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <!-- 他のブロックを追加 -->
        <!-- カスタムブロックを定義 -->
     　　<block type="custom_repeat"></block>
      
    </xml>

    <!-- Blocklyの初期化 -->
    <script>
        // Blocklyの初期化
        var workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox')  // ツールボックスの要素を指定
        });

        // カスタム「繰り返し」ブロックの定義
        Blockly.Blocks['custom_repeat'] = {
            init: function() {
                this.jsonInit({
                    "type": "custom_repeat",
                    "message0": "繰り返す %1 回",
                    "args0": [
                        {
                            "type": "input_value",
                            "name": "TIMES",
                            "check": "Number"  // 入力の型を指定
                        }
                    ],
                    "message1": " %1",
                    "args1": [
                        {
                            "type": "input_statement",
                            "name": "DO"
                        }
                    ],
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": 120,
                    "tooltip": "指定された回数だけブロックを繰り返す"
                });
            }
        };

　　　　　// カスタム「繰り返し」ブロックのJavaScript生成
        Blockly.JavaScript['custom_repeat'] = function(block) {
            var times = Blockly.JavaScript.valueToCode(block, 'TIMES', Blockly.JavaScript.ORDER_NONE) || '0';
            var statements = Blockly.JavaScript.statementToCode(block, 'DO');
            var code = '';
            code += 'for (var i = 0; i < ' + times + '; i++) {\n';
            code += statements + '\n';
            code += '}\n';
            return code;
        };

        

        
        // ブロックが変更された際のコールバックを設定
        workspace.addChangeListener(updateCode);

        // 生成されたコードを表示するためのエリア
        var codeArea = document.getElementById('codeArea');

        // 生成されたコードを更新するコールバック関数
        function updateCode(event) {
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            codeArea.textContent = code;
        }
    </script>

    <!-- 生成されたコードを表示するためのエリア -->
    <pre id="codeArea"></pre>
</body>

</html>

